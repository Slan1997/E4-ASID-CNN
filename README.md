# Sleep Classification With Artificial Synthetic Imaging Data Using Convolutional Neural Networks
# Author Contributions Checklist Form
## Data

### Abstract 

Data considered in this paper are collected with the Empatica E4 wristband during the Health Data Science class study conducted at the University of Michigan. In the study, 24 users aged 22-to-35 years old wore the E4 device on the wrist of their non-dominant hand for approximately 48 hours in January-March 2020. The device tracked 4 physiological modalities including heart rate (HR), acceleration (ACC), electrodermal activity (EDA), and skin temperature (TEMP) with sampling frequency as 1Hz, 32Hz, 4Hz, and 4Hz respectively. 


### Availability 

Due to confidentiality reasons the data cannot be made publicly available. We make publicly available a simulated dataset that mimics the real data. 


### Simulated data

The simulated data “5min_permute.csv” is simulated by permuting 24 subjects’ 5-minute epoch Empatica E4 data (D-5min-HR) from 3 - 5AM. We permute the following variables: sex, age, first quartile, median, third quartile, standard deviation, and arithmetic mean of HR, ACC, and TEMP and median and categorical EDA. We do not permute the response variable (i.e., sleep labels of each subject). Note that we only permute values of these variables when subjects indicate they were asleep in the specified time range of 3-5AM. In this way the sleep labels of each subject remain unchanged. Demographic features (sex and age) in this dataset are simulated by randomly sampling subjects’ original values with replacement. Then “5min_permute_norm.csv” is generated by centering and standardizing the “5min_permute.csv” within individuals and across all subjects. 

## Code

This folder includes all files and data necessary to run and reproduce the results found in Section 5 of the paper. Note that the results are produced for simulated, non-proprietary data.
In general, we have included a collection of code and data files:
* ./E4 ASID Example/reproducibility.R: general script to reproduce the results, it will source the following files
* ./E4 ASID Example/functions.R: all functions needed for the experiment
* ./E4 ASID Example/Train.R: ASID Workflow’s training process, sourcing following files
* ./E4 ASID Example/generate_config_table.R: generate 1-layer CNN configuration table
* ./E4 ASID Example/generate_config_table_layer2.R: generate 2-layer CNN configuration table
* ./E4 ASID Example/Test.R: ASID Workflow’s testing process
* ./E4 ASID Example/Competing_workflow.R: Competing Workflow’s training and testing process
* ./E4 ASID Example/5min_permute.csv: simulated 5min data (D-5min-HR)
* ./E4 ASID Example/5min_permute_norm.csv: normalized simulated 5min data
* ./E4 ASID Example/sleep_tag.csv: the start/end time of sleep of each subject, collected from individuals’ self-reported sleep diaries (This data is used for image plotting)
* ./README.md: README file containing instructions on how to run the code

To reproduce the results, run “reproducibility.R”. Following libraries are needed for running this file:

* Tibble (version 3.1.2)
* tidyr (version 1.0.2) 
* dplyr (version 1.0.6)
* readr (version 1.3.1)
* lubridate (version 1.7.8)
* tfruns (version 1.4)
* rappdirs (version 0.3.1)
* scales (version 1.1.0)
* caret (version 6.0-85)
* magrittr (version 1.5)
* pacman (version 0.5.1)
* ggpubr (0.2.4)
* ggplot2 (version 3.3.2)
* keras (version 2.2.5.0)
* tensorflow (version 2.0.0)

The provided code with permuted D-5min-HR will reproduce results similar to Column 5 of Table 2 and Table 4, and cell (1,3) of Table 3. The user can modify variables in the code “generate_config_table.R” at line 14 and 16 to “l = 14” and “hr = FALSE”, and delete HR related features in  “var_lst” in “reproducibility.R” (at line 32), to reproduce results similar to Column 6 of Table 2 and Table 4, and cell (2,3) of Table 3. Users will not be able to reproduce results similar to other columns/cells of Table 2-4 because the 1-minute and 30-second simulated data are not provided. A similar figure to Figure 5 can be reproduced by combining "subjectx_seedx.png" and "mv_subjectx_seedx.png", which are plotted by the code “reproducibility.R” at line 193-245.

Approximate time needed to reproduce the analyses on a standard desktop machine is 10-60 minutes.

The folder "results generated" are sample results generated by "reproducibility.R".
